function getRiskScore() {
  const url = window.location.href.toLowerCase();
  const hostname = window.location.hostname.toLowerCase();
  let score = 0;

  const riskyKeywords = [
    "login", "verify", "secure", "account",
    "update", "bank", "wallet", "password",
    "signin", "auth"
  ];

  riskyKeywords.forEach(keyword => {
    if (url.includes(keyword)) score += 2;
  });

  // Too long domain
  if (hostname.length > 25) score += 2;

  // Too many subdomains
  if (hostname.split(".").length > 3) score += 2;

  // Suspicious characters
  if (url.includes("@") || url.includes("-")) score += 1;

  return score;
}

function detectLookalikeDomain() {
  const hostname = window.location.hostname;

  const popularTargets = [
    "google", "facebook", "apple",
    "microsoft", "amazon", "paypal"
  ];

  for (let brand of popularTargets) {
    if (
      hostname.includes(brand) &&
      hostname !== `${brand}.com` &&
      !hostname.endsWith(`.${brand}.com`)
    ) {
      return brand;
    }
  }

  return null;
}

function detectInsecurePassword() {
  const passwordField = document.querySelector("input[type='password']");
  if (!passwordField) return false;

  if (window.location.protocol !== "https:") {
    return true;
  }

  return false;
}

function showWarning(message) {
  if (document.getElementById("spoof-warning")) return;

  const banner = document.createElement("div");
  banner.id = "spoof-warning";
  banner.innerText = `âš  SECURITY ALERT: ${message}`;

  Object.assign(banner.style, {
    position: "fixed",
    top: "0",
    left: "0",
    right: "0",
    padding: "14px",
    background: "#b91c1c",
    color: "white",
    fontSize: "14px",
    fontWeight: "bold",
    textAlign: "center",
    zIndex: "999999"
  });

  document.body.appendChild(banner);
}

(function aggressiveScan() {
  const riskScore = getRiskScore();
  const lookalike = detectLookalikeDomain();
  const insecurePwd = detectInsecurePassword();

  console.log("ðŸ›¡ Risk Score:", riskScore);

  if (lookalike) {
    showWarning(`Possible spoofed domain mimicking ${lookalike}`);
    return;
  }

  if (insecurePwd) {
    showWarning("Password field detected on NON-HTTPS page");
    return;
  }

  if (riskScore >= 5) {
    showWarning("High-risk phishing indicators detected");
  }
})();
